<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link href="style.css" rel="stylesheet" type="text/css">
    <script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>
    <script src="https://cdn.8thwall.com/web/aframe/ammo.wasm.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/n5ro/aframe-physics-system@v4.0.1/dist/aframe-physics-system.min.js"></script>
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
    <title>迷路</title>
</head>
<body>
    <a-scene
        cursor="rayOrigin: mouse"
        vr-mode-ui="enabled:true"
        physics="driver: ammo; debug: false; debugDrawMode: 1;"
    >
        <a-entity id="ctlR" laser-controls="hand: right" raycaster="lineColor: red;"></a-entity> 
        <a-sky color="#88ddff"></a-sky>
        <a-plane
            position="-6.5 0 -9"
            rotation="-90 0 0"
            width="20"
            height="21"
            color="#55aa88"
            ammo-body="type: static"
            ammo-shape="type: box"
        ></a-plane>

        <a-entity id="camera" raycaster="objects: .box; far: 0.5;" collider-check position="0 0 0" rotation="0 0 0">
            <a-camera camera look-controls></a-camera>
            <!-- <a-box position="0 1.5 0" ammo-body="type: static" ammo-shape="type: box"></a-box> -->
            <a-text id="txt" value="" position="-1.5 1.5 -1.8" color="red"></a-text>
        </a-entity>

        <!-- <a-assets>
            <img id="renga" src="img/bg2.png">
        </a-assets> -->
        <!-- <a-text id="txt" value="aaaa" position="0.5 1.5 -3" color="red"></a-text> -->
        <a-box position="2 1.5 -3"></a-box>
        <a-box position="2 1.5 -4"></a-box>
        <a-box position="2 1.5 -5"></a-box>
        <a-box position="2 1.5 -6"></a-box>
        <a-box position="2 1.5 -7"></a-box>
        <a-box position="2 1.5 -8"></a-box>
        <a-box position="2 1.5 -9"></a-box>
        <a-box position="2 1.5 -10"></a-box>
        <a-box position="2 1.5 -11"></a-box>
        <a-box position="2 1.5 -12"></a-box>
        <a-box position="2 1.5 -13"></a-box>
        <a-box position="2 1.5 -14"></a-box>
        <a-box position="2 1.5 -15"></a-box>
        <a-box position="2 1.5 -16"></a-box>
        <a-box position="2 1.5 -17"></a-box>
        <a-box position="2 1.5 -18"></a-box>
        <a-box position="1 1.5 -12"></a-box>
        <a-box position="1 1.5 -18"></a-box>
        <a-box position="0 1.5 -12"></a-box>
        <a-box position="0 1.5 -18"></a-box>
        <a-box position="-1 1.5 -3"></a-box>     
        <a-box position="-1 1.5 -6"></a-box>
        <a-box position="-1 1.5 -7"></a-box>
        <a-box position="-1 1.5 -8"></a-box>
        <a-box position="-1 1.5 -9"></a-box>
        <a-box position="-1 1.5 -12"></a-box>
        <a-box position="-1 1.5 -15"></a-box>
        <a-box position="-1 1.5 -18"></a-box>
        <a-box position="-2 1.5 -3"></a-box>
        <a-box position="-2 1.5 -9"></a-box>
        <a-box position="-2 1.5 -15"></a-box>
        <a-box position="-2 1.5 -18"></a-box>
        <a-box position="-3 1.5 -3"></a-box>
        <a-box position="-3 1.5 -9"></a-box>
        <a-box position="-3 1.5 -15"></a-box>
        <a-box position="-3 1.5 -18"></a-box>
        <a-box position="-4 1.5 -3"></a-box>
        <a-box position="-4 1.5 -4"></a-box>
        <a-box position="-4 1.5 -5"></a-box>
        <a-box position="-4 1.5 -6"></a-box>
        <a-box position="-4 1.5 -9"></a-box>
        <a-box position="-4 1.5 -10"></a-box>
        <a-box position="-4 1.5 -11"></a-box>
        <a-box position="-4 1.5 -12"></a-box>
        <a-box position="-4 1.5 -15"></a-box>
        <a-box position="-4 1.5 -16"></a-box>
        <a-box position="-4 1.5 -17"></a-box>
        <a-box position="-4 1.5 -18"></a-box>
        <a-box position="-5 1.5 -3"></a-box>
        <a-box position="-5 1.5 -9"></a-box>
        <a-box position="-5 1.5 -18"></a-box>
        <a-box position="-6 1.5 -3"></a-box>
        <a-box position="-6 1.5 -9"></a-box>
        <a-box position="-6 1.5 -18"></a-box>
        <a-box position="-7 1.5 -3"></a-box>
        <a-box position="-7 1.5 -4"></a-box>
        <a-box position="-7 1.5 -5"></a-box>
        <a-box position="-7 1.5 -6"></a-box>
        <a-box position="-7 1.5 -7"></a-box>
        <a-box position="-7 1.5 -8"></a-box>
        <a-box position="-7 1.5 -9"></a-box>
        <a-box position="-7 1.5 -12"></a-box>
        <a-box position="-7 1.5 -15"></a-box>
        <a-box position="-7 1.5 -18"></a-box>
        <a-box position="-8 1.5 -3"></a-box>
        <a-box position="-8 1.5 -12"></a-box>
        <a-box position="-8 1.5 -15"></a-box>
        <a-box position="-8 1.5 -18"></a-box>
        <a-box position="-9 1.5 -3"></a-box>
        <a-box position="-9 1.5 -12"></a-box>
        <a-box position="-9 1.5 -15"></a-box>
        <a-box position="-9 1.5 -18"></a-box>
        <a-box position="-10 1.5 -3"></a-box>
        <a-box position="-10 1.5 -6"></a-box>
        <a-box position="-10 1.5 -9"></a-box>
        <a-box position="-10 1.5 -10"></a-box>
        <a-box position="-10 1.5 -11"></a-box>
        <a-box position="-10 1.5 -12"></a-box>
        <a-box position="-10 1.5 -15"></a-box>
        <a-box position="-10 1.5 -18"></a-box>
        <a-box position="-11 1.5 -3"></a-box>
        <a-box position="-11 1.5 -6"></a-box>
        <a-box position="-11 1.5 -9"></a-box>
        <a-box position="-11 1.5 -12"></a-box>
        <a-box position="-11 1.5 -15"></a-box>
        <a-box position="-11 1.5 -18"></a-box>
        <a-box position="-12 1.5 -3"></a-box>
        <a-box position="-12 1.5 -4"></a-box>
        <a-box position="-12 1.5 -5"></a-box>
        <a-box position="-12 1.5 -6"></a-box>
        <a-box position="-12 1.5 -9"></a-box>
        <a-box position="-12 1.5 -12"></a-box>
        <a-box position="-12 1.5 -13"></a-box>
        <a-box position="-12 1.5 -14"></a-box>
        <a-box position="-12 1.5 -15"></a-box>
        <a-box position="-12 1.5 -18"></a-box>
        <a-box position="-13 1.5 -9"></a-box>
        <a-box position="-13 1.5 -18"></a-box>
        <a-box position="-14 1.5 -9"></a-box>
        <a-box position="-14 1.5 -18"></a-box>
        <a-box position="-15 1.5 -3"></a-box>
        <a-box position="-15 1.5 -4"></a-box>
        <a-box position="-15 1.5 -5"></a-box>
        <a-box position="-15 1.5 -6"></a-box>
        <a-box position="-15 1.5 -7"></a-box>
        <a-box position="-15 1.5 -8"></a-box>
        <a-box position="-15 1.5 -9"></a-box>
        <a-box position="-15 1.5 -10"></a-box>
        <a-box position="-15 1.5 -11"></a-box>
        <a-box position="-15 1.5 -12"></a-box>
        <a-box position="-15 1.5 -13"></a-box>
        <a-box position="-15 1.5 -14"></a-box>
        <a-box position="-15 1.5 -15"></a-box>
        <a-box position="-15 1.5 -16"></a-box>
        <a-box position="-15 1.5 -17"></a-box>
        <a-box position="-15 1.5 -18"></a-box>        

    </a-scene>

    <input id="go" type="button" value="前">
    <input id="back" type="button" value="後ろ">
    <input id="left" type="button" value="左回り">
    <input id="right" type="button" value="右回り">

    <script>
        $("a-box").attr({
            class: "box",
            rotation:"0 0 0",
            width:"1",
            height:"3",
            depth:"1",
            color:"#dca"
            // src:"#renga"
        });

        // 変数
        let going = false
        let backing = false
        let l_trun = false
        let r_trun = false

        let rotation = $("#camera")[0].object3D.rotation.y;
        let positionZ = $("#camera")[0].object3D.position.z;
        let positionX = $("#camera")[0].object3D.position.x;

        let isIntersect = false;

        setInterval(function(){
            const speed = 0.05;
            if(going){
                positionX += -Math.sin(rotation * Math.PI / 180) * speed;
                positionZ += -Math.cos(rotation * Math.PI / 180) * speed;
                camera.setAttribute('position', {x: positionX, y: 0, z: positionZ});
            }
            if(backing){
                positionX += -Math.sin(rotation * Math.PI / 180) * speed * -1;
                positionZ += -Math.cos(rotation * Math.PI / 180) * speed * -1;
                camera.setAttribute('position', {x: positionX, y: 0, z: positionZ});
            }
            if(l_trun){
                rotation = rotation + Math.PI/2;        
                camera.setAttribute("rotation",{y:rotation});
            }
            if(r_trun){
                rotation = rotation - Math.PI/2;        
                camera.setAttribute("rotation",{y:rotation});
            }
            // console.log(positionZ);
            // console.log(positionX);
            if(positionZ>=-3 && positionX<=-13){
                txt.setAttribute("value", "Congratulations on your goal!");
            }
        }, 10);

        $("#go").on("mousedown",function(){
            going = true;
        });    
        $("#back").on("mousedown",function(){
            backing = true;
        });  
        $("#left").on("mousedown",function(){
            l_trun = true;
        });    
        $("#right").on("mousedown",function(){
            r_trun = true;
        });  
        $("#go,#back,#left,#right").on("mouseup",function(){
            going = false;
            backing = false;
            l_trun = false;
            r_trun = false;
        });   

        


        // 参考にしたサイト
        // https://qiita.com/jyuko/items/db46d11c3a964fdcb34b
        // https://bagelee.com/programming/javascript-2/javascripta-frame-camera/


    </script>
</body>
</html>